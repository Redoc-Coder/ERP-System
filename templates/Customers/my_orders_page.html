<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>XPerience | Shop All you Want</title>
    <link rel="icon" href="/static/images/XPerience-LOGO only.png" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/customers_css/track_order.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha384-rREt3D2T2eVaCYq9Fkt+8X/dFb+aVVrTkTfbr77bTFFFxyVxUmjhUn5HhV8uN9r6" crossorigin="anonymous">
    <!-- Bootstrap icons-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link rel="stylesheet" href="/static/css/customers_css/landingpage.css" />
  </head>
  <body>
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-navbar">
      <div class="container px-4 px-lg-5">
        <!-- Logo and Brand -->
        <div class="d-flex align-items-center">
          <img
            src="/static/images/XPerience-LOGO only.png"
            alt="Logo"
            class="navbar-logo"
          />
          <a class="navbar-brand" href="#!">XPerience</a>
        </div>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0 ms-lg-4">
            <li class="nav-item">
              <a
                class="nav-link active"
                aria-current="page"
                href="{{ url_for('LandingPage') }}"
                >Home</a
              >
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                id="navbarDropdown"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                >Shop</a
              >
              <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                <li>
                  <a class="dropdown-item" href="{{ url_for('LandingPage') }}"
                    >All Products</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a
                    class="dropdown-item"
                    href="{{ url_for('CampingHikingGear') }}"
                    >Camping and Hiking Gear</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="{{ url_for('ExerciseFitnessGear') }}"
                    >Exercise and Fitness Gear</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="{{ url_for('SportsEquipment') }}"
                    >Sports Equipment</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="{{ url_for('OutdoorClothing') }}"
                    >Outdoor Clothing</a
                  >
                </li>
              </ul>
            </li>
          </ul>
          <form class="d-flex">
            <a class="btn btn-outline-dark" href="{{ url_for('Cart') }}">
              <i class="bi-cart-fill me-1"></i>
              Cart
              <span
                id="cart-badge"
                class="badge bg-dark text-white ms-1 rounded-pill"
                >{{ cart_count }}</span
              >
            </a>
          </form>

          <!-- Profile Section -->
          <ul class="navbar-nav">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle d-flex align-items-center"
                href="#"
                id="navbarDropdownMenuLink"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
              <img src="{% if user_image and user_image.profile %}data:image/{{ user_image.mime_type }};base64,{{ user_image.profile }}{% else %}/static/images/default_image.jpg{% endif %}"
               class="rounded-circle ms-2" height="32" width="35" alt="Avatar" loading="lazy" />
              </a>
              <ul
                class="dropdown-menu"
                aria-labelledby="navbarDropdownMenuLink"
              >
                <li>
                  <a class="dropdown-item" href="{{ url_for('MyProfile') }}"
                    >My profile</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="{{ url_for('MyOrder') }}"
                    >My orders</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="{{ url_for('SellerDashboard') }}"
                    >My shop</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="{{ url_for('Login') }}"
                    >Logout</a
                  >
                </li>
              </ul>
            </li>
          </ul>
          <!-- End Profile Section -->
        </div>
      </div>
    </nav>  

     
    
  


    <div class="container mt-5 py-4">
        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link active" id="allOrdersTab" data-toggle="tab" href="#allOrders">All orders</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="toReceiveTab" data-toggle="tab" href="#toReceive">Cancelled</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="deliveredTab" data-toggle="tab" href="#delivered">Received</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="toReviewTab" data-toggle="tab" href="#toReview">Rate orders</a>
          </li>
        </ul>
    
        <!-- Tab Content -->
        <div class="tab-content mt-2">
            <div class="tab-pane fade show active" id="allOrders">

                <div class="row py-2 ">

                  <div class="product-title col-md-4 mt-3" style="font-family: assistant, sans-serif; font-size: 14px;font-weight: 400; font-style: normal; color: rgba(18,18,18,0.75);">
                    <p>PRODUCT DETAILS</p>
                  </div>
                  <div class="product-title col-md-2 mt-3" style="font-family: assistant, sans-serif; font-size: 14px;font-weight: 400; font-style: normal; color: rgba(18,18,18,0.75);">
                    <p>ORDER DATE</p>
                  </div>
                  <div class="product-title col-md-2 mt-3" style=" text-align: end; font-family: assistant, sans-serif; font-size: 14px;font-weight: 400; font-style: normal; color: rgba(18,18,18,0.75);">
                    <p>STATUS</p>
                  </div>
                  
         
          
                 
                </div>
          
                    {% block content %}
                    <div class="cont" id="cart-container">
                        {% for order in orders %}
                        {% if order.status != 'delivered' and order.status != 'cancelled' %}
                        <div class="row" data-product-id="{{ order.id }}" style="cursor: pointer;"
                        data-bs-toggle="modal" data-bs-target="#exampleModal{{ order.id }}">
                        
                        <div class="product  col-md-4 mt-3" >
                        
                              <div class="img-cont">
                              
                                <img src="data:{{ order.mime_type }};base64, {{ order.product_image }}" class="rounded float-start" alt="Product Image" style="margin-right: 30px; 
                                min-height: 70px; max-height: 70px; max-width: 120px; min-width: 120px;">
            
                              </div>
                              <div class="description-cont" style="line-height: 0.5; font-family: assistant, sans-serif; font-style: normal; font-weight: 400; font-size: 14px; color: rgba(18, 18, 18, 0.75);">
                                <p style="color: #121212;">{{ order.seller_name }} </p>
                                <p style="color: #121212;">{{ order.product_name }} ({{order.quantity}})</p>
                                <p>{{ order.product_details|truncate_text(20)}}</p>
                                <p>{{order.total}}.00</p>
                                
                              
                              </div>
                          
                          </div>
                          <div class="col-md-2" style="display: flex; align-items: center;">
                            <p>{{ order.created_at.strftime('%d-%m-%Y %H:%M') }}</p>
                          </div>
                          <div class="col-md-4" style="display: flex; align-items: center; justify-content: flex-end;">
                            <ul class="bs4-order-tracking">
                              {% if order.status == 'placed' %}
                                <li class="step active"> <div><i class="fas fa-user"></i></div> Order Placed </li>
                                <li class="step"> <div><i class="fas fa-truck-loading"></i></div> In transit </li>
                                <li class="step"> <div><i class="fas fa-truck"></i></div> Out for delivery </li>
                                <li class="step"> <div><i class="fas fa-check-circle"></i></div> Delivered </li>
                              {% elif order.status == 'preparing' %}
                                <li class="step active"> <div><i class="fas fa-user"></i></div> Order Placed </li>
                                <li class="step active"> <div><i class="fas fa-truck-loading"></i></div> In transit </li>
                                <li class="step"> <div><i class="fas fa-truck"></i></div> Out for delivery </li>
                                <li class="step"> <div><i class="fas fa-check-circle"></i></div> Delivered </li>
                              {% elif order.status == 'out for delivery' %}
                                <li class="step active"> <div><i class="fas fa-user"></i></div> Order Placed </li>
                                <li class="step active"> <div><i class="fas fa-truck-loading"></i></div> In transit </li>
                                <li class="step active"> <div><i class="fas fa-truck"></i></div> Out for delivery </li>
                                <li class="step"> <div><i class="fas fa-check-circle"></i></div> Delivered </li>
                              {% elif order.status == 'delivered' %}
                                <li class="step active"> <div><i class="fas fa-user"></i></div> Order Placed </li>
                                <li class="step active"> <div><i class="fas fa-truck-loading"></i></div> In transit </li>
                                <li class="step active"> <div><i class="fas fa-truck"></i></div> Out for delivery </li>
                                <li class="step active"> <div><i class="fas fa-check-circle"></i></div> Delivered </li>
                        
                              {% endif %}
                            </ul>
                          </div>
                          <div class="col-md-2 " style="display: flex; align-items: center; justify-content: flex-end;">
                            <form method="post" action="{{ url_for('cancel_order', order_id=order.id) }}">
                              <button type="submit" class="btn btn-outline-danger" style="outline: none !important;">Cancel</button>
                          </form>
                          </div>
                      
                        
                          </div>
    
          {% endif %}
                        {% endfor %}
                        <hr>
                      </div>

                      
                      
                    {% endblock %}
          
            </div>
            <div class="tab-pane fade" id="toReceive">
              
              <div class="row py-2 ">

                <div class="product-title col-md-6 mt-3" style="font-family: assistant, sans-serif; font-size: 14px;font-weight: 400; font-style: normal; color: rgba(18,18,18,0.75);">
                  <p>PRODUCT DETAILS</p>
                </div>
                <div class="product-title col-md-3 mt-3" style="font-family: assistant, sans-serif; font-size: 14px;font-weight: 400; font-style: normal; color: rgba(18,18,18,0.75);">
                  <p>ORDER DATE</p>
                </div>
                <div class="product-title col-md-3 mt-3" style="font-family: assistant, sans-serif; font-size: 14px;font-weight: 400; font-style: normal; color: rgba(18,18,18,0.75);">
                  <p>STATUS</p>
                </div>
                
       
        
               
              </div>
              {% block cancelledContent %}
              <div class="cont" id="to-receive-container">
                  {% for order in orders if order.status == 'cancelled' %}
                     
                  <div class="row" data-product-id="{{ order.id }}">
                      
                    <div class="product  col-md-6 mt-3" >
                     
                          <div class="img-cont">
                           
                            <img src="data:{{ order.mime_type }};base64, {{ order.product_image }}" class="rounded float-start" alt="Product Image" style="margin-right: 30px; 
                            min-height: 70px; max-height: 70px; max-width: 120px; min-width: 120px;">
        
                          </div>
                          <div class="description-cont" style="line-height: 0.5; font-family: assistant, sans-serif; font-style: normal; font-weight: 400; font-size: 14px; color: rgba(18, 18, 18, 0.75);">
                            <p style="color: #121212;">{{ order.seller_name }} </p>
                            <p style="color: #121212;">{{ order.product_name }} ({{order.quantity}})</p>
                            <p>{{ order.product_details|truncate_text(20)}}</p>
                            <p>{{ order.price }}.00</p>
                            
                          
                          </div>
                      
                      </div>
                      <div class="col-md-2" style="display: flex; align-items: center;">
                        <p>{{ order.created_at.strftime('%d-%m-%Y %H:%M') }}</p>
                      </div>
                      <div class="col-md-2" style="display: flex; align-items: center; justify-content: flex-end;">
                        <p>{{order.status}}</p>
                      </div>
                 
                  
                    
                       </div>
                  {% endfor %}
                  <hr>
              </div>
              {% endblock %}
    
            </div>
            <div class="tab-pane fade" id="delivered">
              <div class="row py-2 ">

                <div class="product-title col-md-6 mt-3" style="font-family: assistant, sans-serif; font-size: 14px;font-weight: 400; font-style: normal; color: rgba(18,18,18,0.75);">
                  <p>PRODUCT DETAILS</p>
                </div>
              
                <div class="product-title col-md-3 mt-3" style="  text-align: center; font-family: assistant, sans-serif; font-size: 14px;font-weight: 400; font-style: normal; color: rgba(18,18,18,0.75);">
                  <p>ORDER DATE</p>
                </div>
                <div class="product-title col-md-3 mt-3" style="  text-align: center; font-family: assistant, sans-serif; font-size: 14px;font-weight: 400; font-style: normal; color: rgba(18,18,18,0.75);">
                  <p>RATE</p>
                </div>
          
                
       
        
               
              </div>
              {% block deliveredContent %}
              <div class="cont" id="delivered-container">
                  {% for order in orders if order.status == 'delivered' %}
                  <div class="row" data-product-id="{{ order.id }}">
                      
                    <div class="product  col-md-6 mt-3" >
                     
                          <div class="img-cont">
                           
                            <img src="data:{{ order.mime_type }};base64, {{ order.product_image }}" class="rounded float-start" alt="Product Image" style="margin-right: 30px; 
                            min-height: 70px; max-height: 70px; max-width: 120px; min-width: 120px;">
        
                          </div>
                          <div class="description-cont" style="line-height: 0.5; font-family: assistant, sans-serif; font-style: normal; font-weight: 400; font-size: 14px; color: rgba(18, 18, 18, 0.75);">
                            <p style="color: #121212;">{{ order.seller_name }} </p>
                            <p style="color: #121212;">{{ order.product_name }} ({{order.quantity}})</p>
                            <p>{{ order.product_details|truncate_text(20)}}</p>
                            <p>{{ order.price }}.00</p>
                            
                          
                          </div>
                      
                      </div>
                      <div class="col-md-3" style=" text-align: center; display: flex; align-items: center; justify-content: center;">
                        <p>{{ order.created_at.strftime('%d-%m-%Y %H:%M') }}</p>
                      </div>

                      <div class="col-md-3" style="text-align: end; display: flex; align-items: center; justify-content: center;">
                        <div class="rating">
                          {% for star in range(1, 6) %}
                          {% if star <= order.user_rating %}
                              <i class="fas fa-star text-warning" data-rating="{{ star }}"></i>
                          {% else %}
                              <i class="far fa-star text-gray" data-rating="{{ star }}"></i>
                          {% endif %}
                      {% endfor %}
                      </div>
                    </div>
                     
                     
                  
                    
                       </div>
                  {% endfor %}
                  <hr>
              </div>
              {% endblock %}
            </div>

            <div class="tab-pane fade" id="toReview">
              <div class="row py-2 ">

                <div class="product-title col-md-6 mt-3" style="font-family: assistant, sans-serif; font-size: 14px;font-weight: 400; font-style: normal; color: rgba(18,18,18,0.75);">
                  <p>PRODUCT DETAILS</p>
                </div>
              
                <div class="product-title col-md-3 mt-3" style="  text-align: center; font-family: assistant, sans-serif; font-size: 14px;font-weight: 400; font-style: normal; color: rgba(18,18,18,0.75);">
                  <p>ORDER DATE</p>
                </div>
                <div class="product-title col-md-3 mt-3" style="  text-align: center; font-family: assistant, sans-serif; font-size: 14px;font-weight: 400; font-style: normal; color: rgba(18,18,18,0.75);">
                  <p>RATE</p>
                </div>
          
                
       
        
               
              </div>
              {% block toReviewContent %}
              <div class="cont" id="toReview-container">
                  {% for order in orders if order.status == 'delivered' %}
                  <div class="row" data-product-id="{{ order.id }}">
                      
                    <div class="product  col-md-6 mt-3" >
                     
                          <div class="img-cont">
                           
                            <img src="data:{{ order.mime_type }};base64, {{ order.product_image }}" class="rounded float-start" alt="Product Image" style="margin-right: 30px; 
                            min-height: 70px; max-height: 70px; max-width: 120px; min-width: 120px;">
        
                          </div>
                          <div class="description-cont" style="line-height: 0.5; font-family: assistant, sans-serif; font-style: normal; font-weight: 400; font-size: 14px; color: rgba(18, 18, 18, 0.75);">
                            <p style="color: #121212;">{{ order.seller_name }} </p>
                            <p style="color: #121212;">{{ order.product_name }} ({{order.quantity}})</p>
                            <p>{{ order.product_details|truncate_text(20)}}</p>
                            <p>{{ order.price }}.00</p>
                            
                          
                          </div>
                      
                      </div>
                      <div class="col-md-3" style=" text-align: center; display: flex; align-items: center; justify-content: center;">
                        <p>{{ order.created_at.strftime('%d-%m-%Y %H:%M') }}</p>
                      </div>

                      <div class="col-md-3" style="text-align: end; display: flex; align-items: center; justify-content: center;">
                        <div class="rating" data-order-id="{{ order.product_id }}" ">
                            <i class="fas fa-star" data-rating="1"></i>
                            <i class="fas fa-star" data-rating="2"></i>
                            <i class="fas fa-star" data-rating="3"></i>
                            <i class="fas fa-star" data-rating="4"></i>
                            <i class="fas fa-star" data-rating="5"></i>
                        </div>
                    </div>
                     
                     
                  
                    
                       </div>
                  {% endfor %}
                  <hr>
              </div>
              {% endblock %}
            </div>
   
      
   
      </div>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', function () {
    var rows = document.querySelectorAll('.row');
    rows.forEach(function (row) {
      row.addEventListener('click', function () {
        var targetModalId = row.getAttribute('data-bs-target');
        var targetModal = new bootstrap.Modal(document.getElementById(targetModalId));
        targetModal.show();
      });
    });
  });


    //stars
    document.addEventListener('DOMContentLoaded', function () {
  // Get all rating containers
  const ratingContainers = document.querySelectorAll('.rating');

  // Iterate over each container
  ratingContainers.forEach(container => {
    // Get all stars within the container
    const stars = container.querySelectorAll('i');
    const orderId = container.dataset.orderId;
    const initialRating = container.dataset.initialRating;

    console.log('orderId:', orderId);
    console.log('initialRating:', initialRating);

    // Highlight stars based on the initial rating from the database
    stars.forEach(star => {
      const starRating = star.dataset.rating;
      if (starRating <= initialRating) {
        star.classList.add('fas', 'text-warning');
      }
    });

    // Attach click event listener to each star
    stars.forEach(star => {
      star.addEventListener('click', function () {
        const clickedRating = this.dataset.rating;

        console.log('clickedRating:', clickedRating);

        // Set the clicked stars to yellow, and the rest to gray
        stars.forEach(star => {
          const starRating = star.dataset.rating;
          if (starRating <= clickedRating) {
            star.classList.add('fas', 'text-warning');
            star.classList.remove('far', 'text-gray');
          } else {
            star.classList.remove('fas', 'text-warning');
            star.classList.add('far', 'text-gray');
          }
        });

        // Send the orderId and rating to the server using fetch
        fetch('/store_rating', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            orderId: orderId,
            rating: clickedRating,
          }),
        })
          .then(response => response.json())
          .then(data => {
            console.log(data.message);
            // Optionally, update the UI or perform other actions
          })
          .catch(error => {
            console.error('Error:', error);
          });
      });
    });
  });
});
      </script>
    
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    




    <!-- Footer-->
 
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap core JS-->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <script src="/static/js/addtocart.js"></script>
  </body>
</html>
